{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport ScrollView from \"react-native-web/dist/exports/ScrollView\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport View from \"react-native-web/dist/exports/View\";\nimport { useEffect, useState } from 'react';\nimport { Provider as PaperProvider, TextInput } from 'react-native-paper';\nimport { Button, Card } from 'react-native-paper';\nimport { StatusBar } from 'expo-status-bar';\nimport { SafeAreaView } from 'react-native-safe-area-context';\nimport { initializeApp } from \"firebase/app\";\nimport { getAuth, signInWithCustomToken } from \"firebase/auth\";\nimport { getDatabase, ref, push, serverTimestamp, query, orderByChild, equalTo, limitToLast } from \"firebase/database\";\nimport { getFunctions, httpsCallable } from 'firebase/functions';\nimport { useAuthState } from 'react-firebase-hooks/auth';\nimport { useList } from 'react-firebase-hooks/database';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nvar firebaseConfig = {\n  apiKey: \"AIzaSyDBjUEw_DQNMQsZJWfTtLL0PQJoH-xF0kk\",\n  authDomain: \"sta-cs5041.firebaseapp.com\",\n  databaseURL: \"https://sta-cs5041-p4.firebaseio.com\",\n  projectId: \"sta-cs5041\",\n  storageBucket: \"sta-cs5041.appspot.com\",\n  messagingSenderId: \"639987847762\",\n  appId: \"1:639987847762:web:c5a35616a1aa1cf243458b\"\n};\nvar firebaseToken = \"9dd8d43a-01db-4286-b0e8-371d24237380\";\nvar firebaseApp = initializeApp(firebaseConfig);\nvar auth = getAuth(firebaseApp);\nvar database = getDatabase(firebaseApp);\nvar functions = getFunctions(firebaseApp);\nvar CardComponent = function CardComponent(_ref) {\n  var message = _ref.message,\n    i = _ref.i,\n    iMax = _ref.iMax;\n  return _jsx(Card, {\n    style: {\n      marginLeft: 10,\n      marginRight: 10,\n      marginTop: i === 0 ? 0 : 10,\n      marginBottom: i === iMax ? 0 : 10\n    },\n    children: _jsx(Card.Title, {\n      title: message\n    })\n  });\n};\nvar Add = function Add(_ref2) {\n  var user = _ref2.user;\n  var _useState = useState(\"\"),\n    _useState2 = _slicedToArray(_useState, 2),\n    text = _useState2[0],\n    setText = _useState2[1];\n  return _jsxs(View, {\n    style: {\n      display: 'flex',\n      flexDirection: 'row'\n    },\n    children: [_jsx(TextInput, {\n      style: {\n        margin: 10\n      },\n      label: \"Message\",\n      value: text,\n      onChangeText: function onChangeText(text) {\n        return setText(text);\n      }\n    }), _jsx(Button, {\n      style: {\n        margin: 10,\n        alignSelf: \"center\"\n      },\n      icon: \"send\",\n      onPress: function onPress() {\n        push(ref(database, \"data\"), {\n          userId: user.uid,\n          groupId: 20,\n          timestamp: serverTimestamp(),\n          type: \"str\",\n          string: text.toString()\n        });\n      },\n      children: \"post\"\n    })]\n  });\n};\nvar Messages = function Messages(props) {\n  return _jsx(ScrollView, {\n    style: {\n      margin: 10\n    },\n    children: props.messages.map(function (el, i) {\n      return _jsx(CardComponent, {\n        message: el,\n        iMax: props.messages.length,\n        i: i\n      }, i);\n    })\n  });\n};\nexport default function MessagesScreen() {\n  var _useAuthState = useAuthState(auth),\n    _useAuthState2 = _slicedToArray(_useAuthState, 3),\n    user = _useAuthState2[0],\n    authLoading = _useAuthState2[1],\n    authError = _useAuthState2[2];\n  useEffect(function () {\n    _asyncToGenerator(function* () {\n      var _token$data, _token$data2;\n      var getToken = httpsCallable(functions, \"getToken\");\n      var token = yield getToken({\n        token: firebaseToken\n      });\n      if ((token == null ? void 0 : (_token$data = token.data) == null ? void 0 : _token$data.result) === \"ok\" && token != null && (_token$data2 = token.data) != null && _token$data2.token) {\n        signInWithCustomToken(auth, token.data.token);\n      } else {\n        var _token$data$reason, _token$data3;\n        console.error((_token$data$reason = token == null ? void 0 : (_token$data3 = token.data) == null ? void 0 : _token$data3.reason) != null ? _token$data$reason : \"unknownError\");\n      }\n    })();\n  }, []);\n  var _useList = useList(user ? query(ref(database, 'data'), orderByChild('groupId'), equalTo(20), limitToLast(3)) : null),\n    _useList2 = _slicedToArray(_useList, 3),\n    snapshots = _useList2[0],\n    dbLoading = _useList2[1],\n    dbError = _useList2[2];\n  return _jsx(PaperProvider, {\n    children: _jsxs(SafeAreaView, {\n      style: styles.container,\n      children: [_jsx(Add, {\n        user: user\n      }), snapshots ? _jsx(Messages, {\n        messages: snapshots.map(function (el) {\n          var _el$val$string, _el$val;\n          return (_el$val$string = el == null ? void 0 : (_el$val = el.val()) == null ? void 0 : _el$val.string) != null ? _el$val$string : '';\n        })\n      }) : null, _jsx(StatusBar, {\n        style: \"auto\"\n      })]\n    })\n  });\n}\nvar styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    backgroundColor: '#fff',\n    alignItems: 'center',\n    justifyContent: 'center'\n  }\n});","map":{"version":3,"names":["useEffect","useState","Provider","PaperProvider","TextInput","Button","Card","StatusBar","SafeAreaView","initializeApp","getAuth","signInWithCustomToken","getDatabase","ref","push","serverTimestamp","query","orderByChild","equalTo","limitToLast","getFunctions","httpsCallable","useAuthState","useList","jsx","_jsx","jsxs","_jsxs","firebaseConfig","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","appId","firebaseToken","firebaseApp","auth","database","functions","CardComponent","_ref","message","i","iMax","style","marginLeft","marginRight","marginTop","marginBottom","children","Title","title","Add","_ref2","user","_useState","_useState2","_slicedToArray","text","setText","View","display","flexDirection","margin","label","value","onChangeText","alignSelf","icon","onPress","userId","uid","groupId","timestamp","type","string","toString","Messages","props","ScrollView","messages","map","el","length","MessagesScreen","_useAuthState","_useAuthState2","authLoading","authError","_asyncToGenerator","_token$data","_token$data2","getToken","token","data","result","_token$data$reason","_token$data3","console","error","reason","_useList","_useList2","snapshots","dbLoading","dbError","styles","container","_el$val$string","_el$val","val","StyleSheet","create","flex","backgroundColor","alignItems","justifyContent"],"sources":["/cs/home/sz78/Documents/my-expo-app/examples-master/with-drawer-navigation/MessagesScreen.js"],"sourcesContent":["import { ScrollView, StyleSheet, View } from 'react-native';\nimport { useEffect, useState } from 'react';\n\nimport { Provider as PaperProvider, TextInput } from 'react-native-paper';\nimport { Button, Card } from 'react-native-paper';\n\nimport { StatusBar } from 'expo-status-bar';\n\nimport { SafeAreaView } from 'react-native-safe-area-context';\n\nimport { initializeApp } from \"firebase/app\";\nimport { getAuth, signInWithCustomToken } from \"firebase/auth\";\nimport { getDatabase, ref, push, serverTimestamp, query, orderByChild, equalTo, limitToLast } from \"firebase/database\";\nimport { getFunctions, httpsCallable } from 'firebase/functions';\n\nimport { useAuthState } from 'react-firebase-hooks/auth';\nimport { useList } from 'react-firebase-hooks/database';\n\nconst firebaseConfig = {\n  apiKey: \"AIzaSyDBjUEw_DQNMQsZJWfTtLL0PQJoH-xF0kk\",\n  authDomain: \"sta-cs5041.firebaseapp.com\",\n  databaseURL: \"https://sta-cs5041-p4.firebaseio.com\",\n  projectId: \"sta-cs5041\",\n  storageBucket: \"sta-cs5041.appspot.com\",\n  messagingSenderId: \"639987847762\",\n  appId: \"1:639987847762:web:c5a35616a1aa1cf243458b\"\n};\n\nconst firebaseToken = \"9dd8d43a-01db-4286-b0e8-371d24237380\";\n\nconst firebaseApp = initializeApp(firebaseConfig);\nconst auth = getAuth(firebaseApp);\nconst database = getDatabase(firebaseApp);\nconst functions = getFunctions(firebaseApp);\n\nconst CardComponent = ({ message, i, iMax }) => (\n  <Card style={{\n    marginLeft: 10, marginRight: 10, marginTop: i === 0 ? 0 : 10, marginBottom: i === iMax ? 0 : 10\n  }}>\n    <Card.Title title={message} />\n  </Card>\n);\n\nconst Add = ({ user }) => {\n\n  const [text, setText] = useState(\"\");\n\n  return (\n    <View style={{ display: 'flex', flexDirection: 'row' }}>\n      <TextInput style={{ margin: 10 }}\n        label=\"Message\"\n        value={text}\n        onChangeText={text => setText(text)}\n      ></TextInput>\n      <Button style={{ margin: 10, alignSelf: \"center\" }} icon=\"send\" onPress={() => {\n        push(ref(database, \"data\"), {\n          userId: user.uid,\n          groupId: 20,\n          timestamp: serverTimestamp(),\n          type: \"str\",\n          string: text.toString()\n        });\n      }}>\n        post\n      </Button>\n    </View>\n  )\n}\n\nconst Messages = (props) => {\n  return (\n    <ScrollView style={{ margin: 10 }}>\n      {props.messages.map((el, i) =>\n        <CardComponent key={i} message={el} iMax={props.messages.length} i={i}></CardComponent>\n      )}\n    </ScrollView>\n  )\n}\n\nexport default function MessagesScreen() {\n\n  const [user, authLoading, authError] = useAuthState(auth);\n\n  useEffect(() => {\n    (async () => {\n      const getToken = httpsCallable(functions, \"getToken\");\n      const token = await getToken({ token: firebaseToken });\n      if (token?.data?.result === \"ok\" && token?.data?.token) {\n        signInWithCustomToken(auth, token.data.token);\n      } else {\n        console.error(token?.data?.reason ?? \"unknownError\")\n      }\n    })();\n  }, []);\n\n  const [snapshots, dbLoading, dbError] = useList(user ? query(ref(database, 'data'), orderByChild('groupId'), equalTo(20), limitToLast(3)) : null);\n\n  return (\n    <PaperProvider>\n      <SafeAreaView style={styles.container}>\n        <Add user={user}></Add>\n        {snapshots ?\n          <Messages messages={snapshots.map(el => el?.val()?.string ?? '')}></Messages>\n          : null}\n        <StatusBar style=\"auto\" />\n      </SafeAreaView>\n    </PaperProvider>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    backgroundColor: '#fff',\n    alignItems: 'center',\n    justifyContent: 'center',\n  },\n});\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}